<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TruthΩ Trading Demo (browser)</title>
<style>
body{font-family:system-ui;background:#0d1117;color:#e6edf3;text-align:center;padding:2em}
input,button{margin:8px;padding:6px 10px;border-radius:6px;border:1px solid #30363d;background:#161b22;color:#e6edf3}
button{cursor:pointer}
button:hover{background:#21262d}
pre{background:#10151d;padding:10px;border-radius:8px;white-space:pre-wrap;text-align:left;max-width:90%;margin:auto}
</style>
</head>
<body>
<h2>TruthΩ Trading Demo (browser)</h2>
<p>Carica un file CSV tipo <b>sample_ohlcv.csv</b> e calcola <b>TruthΩ → Co⁺ → Score⁺</b>.</p>

<input type="file" id="fileInput" accept=".csv">
<button id="calcBtn">Calcola</button>
<button id="downloadBtn" style="display:none;">Scarica risultati CSV</button>

<pre id="output"></pre>

<script>
document.getElementById('calcBtn').onclick = async () => {
  const file = document.getElementById('fileInput').files[0];
  if (!file) return alert("Seleziona un file CSV prima.");
  const text = await file.text();
  const rows = text.trim().split("\n").map(r=>r.split(","));
  const header = rows.shift();
  const results = [["date","TruthΩ","Co⁺","Score⁺"]];

  for(const r of rows){
    const [date,open,high,low,close,volume] = r;
    const diff = close - open;
    const truth = Math.log(Math.abs(diff)+1) * (diff>=0?1:-1);
    const co = Math.exp(-Math.abs(truth));
    const score = (co * 100 - Math.abs(truth*10)).toFixed(3);
    results.push([date,truth.toFixed(4),co.toFixed(4),score]);
  }

  // mostra output
  document.getElementById("output").textContent = results.map(r=>r.join(",")).join("\n");

  // genera CSV
  const csvContent = results.map(r=>r.join(",")).join("\n");
  const blob = new Blob([csvContent], {type: "text/csv"});
  const url = URL.createObjectURL(blob);
  const btn = document.getElementById("downloadBtn");
  btn.style.display = "inline-block";
  btn.onclick = ()=> {
    const a = document.createElement("a");
    a.href = url;
    a.download = "truthomega_results.csv";
    a.click();
  };
};
</script>
</body>
</html>